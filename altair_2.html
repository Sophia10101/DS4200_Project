<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title> Graph 4 - Track Attribute Ridgeline Plot</title>
  <!-- shared stylesheet -->
  <link rel="stylesheet" href="styles.css" />
  <style>
    #vis.vega-embed {
      width: 100%;
      display: flex;
    }

    #vis.vega-embed details,
    #vis.vega-embed details summary {
      position: relative;
    }

    .viz-main {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .viz-controls {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.25rem;
    }

    .viz-select {
      font-size: 0.9rem;
      background: rgba(8, 14, 35, 0.9);
      color: #ffffff;
      border-radius: 999px;
      border: 1px solid rgba(120, 140, 210, 0.7);
      padding: 0.2rem 0.8rem;
      outline: none;
    }

    .viz-select:focus {
      border-color: #4f9dff;
      box-shadow: 0 0 0 1px rgba(79, 157, 255, 0.5);
    }

    #vis {
      width: 100%;
      min-width: 0;
    }

    #vis.vega-embed {
      width: 100%;
      display: flex;
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.1"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body class="spotify-page">
  <div class="container">
  <div id="header-placeholder"></div>
  <script src="js/header.js"></script>

    <div class="page">

      <main>
        <section class="section">
          <h2>Distribution of Danceability Scores with Altair</h2>
          <p class="description">
            This ridgeline plot shows the distribution of danceability scores for the top 10 Spotify playlist genres. 
            Each colored layer represents one genre, allowing viewers to compare how danceable the tracks are within each one. 
            The curves highlight where most songs fall along the danceability scale. There is a dropdown menu to select different audio features
            such as energy, valence, and acousticness to see how those attributes vary across genres.
          </p>
        </section>

        <!-- Altair chart here -->
      <section class="section viz-section">
        <div class="viz-main">
          <div class="viz-controls">
            <label for="feature-select" class="viz-label">select feature:</label>
            <select id="feature-select" class="viz-select">
              <option value="danceability">Danceability</option>
              <option value="energy">Energy</option>
              <option value="valence">Valence</option>
              <option value="liveness">Liveness</option>
              <option value="speechiness">Speechiness</option>
              <option value="acousticness">Acousticness</option>
            </select>
          </div>
          <div id="vis"></div>
        </div>

        <div class="viz-text" style="margin-top: 1.5rem;">
          <h2>Key Takeaways</h2>
            <p> We will look at Danceability first as the default feature shown in the plot, but users can select other audio features from the dropdown menu to see how they compare across genres.
              Pop, Rock, and Hip-Hop have the widest and most pronounced distributions,
              showing a large number of mid-to-high danceability tracks.
            
                Hip-Hop shows strong peaks at high danceability scores indicating that this genre consistently features
                more rhythmic and danceable music. 
          
                Several genres display flatter and lower peaks overall, which suggests a more even spread of 
                danceability values rather than strong concentrations at any one level.
            

                Hip-hop looks like the most danceable genre overall, with a high peak toward the upper end of the danceability scale. Metal shows the lowest danceability levels, 
                with a flatter curve and very few tracks reaching the high-danceability range.
    
          
                The gaming genre shows no strong peaks but spans the widest range of danceability values, 
                indicating it features a diverse mix of tracks. Pop and hip-hop remain the two genres that most consistently appear to be danceable, 
                showing strongly just how well rhythm-forward tracks perform across playlists. Many genres with flatter curves indicate more consistent 
                patterns in terms of danceability, meaning listeners may experience fewer extreme highs or lows within a given genre. These comparisons show how each genre forms 
                expectations for listeners; there are clear contrasts in how artists approach the art of movement, rhythm, and energy in their music.


            <p>
            
            <!--- reference / inspiration section -->
            <h2>References & Inspiration </h2>
            <p>
              <strong>Altair Ridgeline Plot Example</strong>
              <a href="linkhttps://altair-viz.github.io/gallery/ridgeline_plot.html"
                target="_blank">
                “Ridgeline Plot”</a> <br>
            The design of this visualization was adapted from the above altair ridgeline plot example and
            modified to compare danceability across Spotify playlist genres using a csv of spotify data.
            </p>
          </div>
        </section>
      </main>
    </div>
    <script>
      (function (vegaEmbed) {

        var baseSpec = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json",
          "config": {
            "view": {
              "continuousWidth": 300,
              "continuousHeight": 300,
              "stroke": null
            },
            "facet": {
              "spacing": 0
            },
            "title": {
              "anchor": "end"
            }
          },

          "data": {
            "url": "cleandata/alt2_top10_genre_audio_features.json",
            "format": { "type": "json" }
          },

          "facet": {
            "row": {
              "field": "playlist_genre",
              "type": "nominal",
              "title": null,
              "header": {
                "labelAngle": 0,
                "labelAlign": "left",
                "labelColor": "#e6ebff",
                "labelFontSize": 12,
                "labelPadding": 6
              }
            }
          },

          "spec": {
            "mark": {
              "type": "area",
              "fillOpacity": 0.8,
              "interpolate": "monotone",
              "stroke": "lightgray",
              "strokeWidth": 0.5
            },
            "encoding": {
              "fill": {
                "field": "playlist_genre",
                "legend": null,
                "scale": {
                  "range": [
                    "#4f9dff",
                    "#36fba1",
                    "#ff6bd5",
                    "#ffb347",
                    "#b266ff",
                    "#ff4f81",
                    "#00d4ff",
                    "#7fff7f",
                    "#ffd54f",
                    "#ff9ff3"
                  ]
                },
                "type": "nominal"
              },
              "x": {
                "bin": "binned",
                "field": "bin_min",
                "title": "danceability (0–1)",
                "type": "quantitative"
              },
              "y": {
                "axis": null,
                "field": "value",
                "scale": { "range": [50, -50] },
                "type": "quantitative"
              }
            },
            "height": 50,
            "width": 700,
            "transform": [
              {
                "joinaggregate": [
                  {
                    "op": "mean",
                    "field": "danceability",
                    "as": "mean_value"
                  }
                ],
                "groupby": ["playlist_genre"]
              },
              {
                "bin": true,
                "field": "danceability",
                "as": ["bin_max", "bin_min"]
              },
              {
                "aggregate": [
                  {
                    "op": "count",
                    "as": "value"
                  }
                ],
                "groupby": [
                  "playlist_genre",
                  "mean_value",
                  "bin_min",
                  "bin_max"
                ]
              },
              {
                "impute": "value",
                "key": "bin_min",
                "groupby": ["playlist_genre", "mean_value"],
                "value": 0
              }
            ]
          }
        };

        
        
        const spotifyNeonPalette = [
          "#4f9dff",
          "#36fba1",
          "#ff6bd5",
          "#ffb347",
          "#b266ff",
          "#ff4f81",
          "#00d4ff",
          "#7fff7f",
          "#ffd54f",
          "#ff9ff3"
        ];

        function styleAndRetargetSpec(featureField) {
          const field = featureField || "danceability";
          const spec = JSON.parse(JSON.stringify(baseSpec));

          spec.config = {
            background: "rgba(0,0,0,0)",
            view: { stroke: null },
            axis: {
              labelColor: "#ffffff",
              titleColor: "#ffffff",
              gridColor: "rgba(160,180,230,0.18)",
              domainColor: "rgba(200,210,255,0.6)",
              tickColor: "rgba(200,210,255,0.6)",
              labelFontSize: 11,
              titleFontSize: 12
            },
            legend: {
              labelColor: "#ffffff",
              titleColor: "#ffffff"
            },
            title: {
              color: "#ffffff",
              anchor: "start",
              fontSize: 28
            }
          };

          spec.spec.width = 1100;
          spec.title = "Distribution of " + field + " by Top 10 Playlist Genres";

          if (spec.facet && spec.facet.row) {
            spec.facet.header = {
              labelColor: "#ffffff",
              labelFontSize: 12,
              title: null
            };
          }

          spec.spec.transform.forEach(t => {
            if (t.bin && t.as?.includes("bin_min")) {
              t.field = field;
            }
          });

          if (spec.spec && spec.spec.encoding && spec.spec.encoding.x) {
            spec.spec.encoding.x.field = "bin_min";
            spec.spec.encoding.x.title = field + " (0–1)";
          }

          if (spec.spec.encoding.fill.scale) {
            spec.spec.encoding.fill.scale.range = spotifyNeonPalette;
          }

          spec.spec.height = 48;
          spec.facet.spacing = 3;

          return spec;
        }

        const embedOpt = {
          mode: "vega-lite",
          renderer: "canvas",
          actions: false,
          config: {
            background: "rgba(0,0,0,0)"
          }
        };

        const el = document.getElementById("vis");
        const selectEl = document.getElementById("feature-select");

        function render(feature) {
          const spec = styleAndRetargetSpec(feature);
          vegaEmbed("#vis", spec, embedOpt).catch(error => showError(el, error));
        }

        // initial render
        const initialFeature = selectEl ? selectEl.value : "danceability";
        render(initialFeature);

        // update when dropdown changes
        if (selectEl) {
          selectEl.addEventListener("change", e => {
            render(e.target.value);
          });
        }
      })(vegaEmbed);
    </script>

  </div> <!-- end container -->

</body>
</html>
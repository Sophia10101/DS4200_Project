<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Graph 3 - Genre Popularity Density Chart</title>
  <!-- shared stylesheet -->
  <link rel="stylesheet" href="styles.css" />
  <style>
    #vis.vega-embed {
      width: 100%;
    }

    #vis.vega-embed details,
    #vis.vega-embed details summary {
      position: relative;
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.20.1"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body class="spotify-page">
  <div class="container">
  <div id="header-placeholder"></div>
  <script src="js/header.js"></script>
    <div class="page">

      <main>
        <section class="section">
          <h2>Distribution Of Track Popularity Across The Top 10 Spotify Genres</h2>
          <p class="description">
            This chart shows the distribution of track popularity across the top 10 Spotify genres.
            Use the slider to filter by maximum popularity and click a genre line to highlight it. Each curve 
            represents the density of popularity scores for a specific genre to compare how popularity is spread across
            the most popular genres on spotify. 

          </p>
        </section>

        <!-- Altair chart here -->
      <section class="section viz-section">
          <div id="vis"></div>
          <div class="viz-text" style="margin-top: 1.5rem;">
            <h2>Key Takeaways</h2>
              <p>
                Genres vary in how tightly their popularity scores cluster, with some showing sharper peaks than others.
                R&B (purple) has the highest and most pronounced peak, centered around the 75â€“77 popularity range. This means R&B tracks tend to concentrate at higher popularity scores.
                Korean, Gaming, and Metal also show strong peaks but more spread out than R&B, while genres like pop and k-pop have flatter, more variable distributions.
                Lowering the popularity filter shows how some genres drop off quickly, revealing which ones rely more on their most popular tracks. As the the curves shift with the slider, we can see
                which genres mantain a steady popularity even when the filter has a tighter range. The overlap between several genres
                shows that popularity is not dictated by a singular musical style since different genres shared high performance rates. Overall
                this visualization helps to reveal which genres have broad mainstream reach and which ones depend on one or a few super popular tracks. 
              <p>
        </section>
        <section class="section">
            <h2>Interactivity</h2>
              <ul>
                <li>
                  <strong>Slider (Min/Max Popularity):</strong> The slider allows viewers to filter the chart by setting a maximum popularity value (default 100). 
                  As you lower the slider, only tracks at or below that popularity level remain in the visualization. 
                  This reveals how each genre behaves when focusing on less-popular tracks and shows which genres still 
                  maintain peaks versus which ones flatten out.
                </li>
                <li>
                  <strong>Click to Highlight Curve</strong>
                  Clicking on a genre curve highlights that genre while fading the others to grey. This makes it easier to focus on one distribution 
                  and clearly see its shape, peak, and spread without visual distractions. 
                </li>
                <li>
                  <strong>Hoverable Tooltip</strong>
                  Clicking on a genre curve or hovering will also allow you to hover over points along the line to see exact values for track popularity and density at that point.
                  This provides precise data insights beyond just the visual shape of the curve.
                </li>
              <ul>
          </div>
        </section>
      </main>
    </div>
    <script>
      (function(vegaEmbed) {
        var spec = {
        "config": {
          "view": { "continuousWidth": 300, "continuousHeight": 300 },
          "legend": {
            "labelColor": "#ffffff",
            "titleColor": "#ffffff",
            "labelFontSize": 13,
            "titleFontSize": 14,
            "symbolSize": 200
          },
          "axis": {
            "labelColor": "#ffffff",
            "titleColor": "#ffffff",
            "gridColor": "#2a2f45"
          }
        },

        "data": {
          "url": "cleandata/alt1_top10_genre_popularity.json",
          "format": { "type": "json" }
        },

        // thicker lines = better hover target
        "mark": {
          "type": "line",
          "strokeWidth": 7,
          "strokeJoin": "round",
          "strokeCap": "round"
        },

        "encoding": {
          "x": {
            "field": "track_popularity",
            "type": "quantitative",
            "title": "Track popularity"
          },
          "y": {
            "field": "density",
            "type": "quantitative",
            "title": "Density"
          },
          "color": {
            "field": "playlist_genre",
            "type": "nominal",
            "title": "Genre",
            "scale": {
              "range": [
                "#4f9dff",
                "#36fba1",
                "#ff6bd5",
                "#ffb347",
                "#b266ff",
                "#ff4f81",
                "#00d4ff",
                "#7fff7f",
                "#ffd54f",
                "#ff9ff3"
              ]
            },
            "legend": {
              "title": "Genre",
              "orient": "right",
              "symbolSize": 400,
              "symbolStrokeWidth": 6,
              "symbolType": "stroke",
              "entryPadding": 12,
              "labelPadding": 12,
              "labelFontSize": 15,
              "titleFontSize": 16,
              "labelColor": "#ffffff",
              "titleColor": "#ffffff"
            }
          },

          "opacity": {
            "condition": { "param": "param_1", "value": 1 },
            "empty": false,
            "value": 0.2
          },

          // tooltip with genre name + values
          "tooltip": [
            { "field": "playlist_genre", "type": "nominal", "title": "Genre" },
            { "field": "track_popularity", "type": "quantitative", "title": "Popularity" },
            { "field": "density", "type": "quantitative", "title": "Density", "format": ".3f" }
          ]
        },

        "height": 400,
        "params": [
          {
            "name": "param_1",
            "select": {
              "type": "point",
              "encodings": ["color"], 
              "on": "click",
              "bind": "legend"
            }
          },
          {
            "name": "param_2",
            "bind": {
              "input": "range",
              "max": 100,
              "min": 0,
              "name": "Max Popularity: ",
              "step": 5
            },
            "value": 100
          },
          {
            "name": "param_3",
            "bind": {
              "input": "range",
              "min": 0,
              "max": 100,
              "step": 5,
              "name": "Min Popularity: "
            },
            "value": 0
          }
        ],
        "transform": [
          {"filter": "(datum.track_popularity >= param_3 && datum.track_popularity <= param_2)"},
          { "density": "track_popularity",
            "groupby": ["playlist_genre"],
            "as": ["track_popularity", "density"]}],
        "width": 800,
        "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json"};

        spec.config = {
          background: "rgba(0,0,0,0)",
          view: {
            continuousWidth: 300,
            continuousHeight: 300,
            stroke: null
          },
          axis: {
            labelColor: "#ffffff",
            titleColor: "#ffffff",
            gridColor: "rgba(160,180,230,0.28)",
            domainColor: "rgba(200,210,255,0.8)",
            tickColor: "rgba(200,210,255,0.8)",
            labelFontSize: 11,
            titleFontSize: 12
          },
          legend: {
            labelColor: "#ffffff",
            titleColor: "#ffffff",
          },
          title: {
            color: "#ffffff",
            fontSize: 28,
            anchor: "start"
          }
        };
        
        // make the chart responsive to the container width
        spec.width = "container";

        var embedOpt = {
          mode: "vega-lite",
          renderer: "canvas",
          actions: false,
          config: {
            background: "rgba(0,0,0,0)"
          }
        };

        const el = document.getElementById('vis');
        vegaEmbed("#vis", spec, embedOpt)
          .catch(error => showError(el, error));
      })(vegaEmbed);

    </script>
  </div> <!-- end container -->
</body>
</html>